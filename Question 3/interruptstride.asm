LIST P=PIC16F877A
#INCLUDE <P16F877A.INC>
__CONFIG H'3F31'

D1	EQU 0X20
D2	EQU 0X21

ORG 0x00
GOTO START

; Interrupt block
ORG 0x04
BCF INTCON, INTF
BTFSS PORTB, 0  ; Check RB0 state
GOTO RIGHT_SHIFT
GOTO LEFT_SHIFT

RIGHT_SHIFT
BANKSEL PORTD
RRF PORTD, F    ; Right shift PORTD
BANKSEL TRISD
BSF TRISD, 7    ; Set MSB as output
RETFIE

LEFT_SHIFT
BANKSEL PORTD
RLF PORTD, F    ; Left shift PORTD
BANKSEL TRISD
BCF TRISD, 7    ; Set MSB as input
RETFIE

START
BANKSEL TRISD
CLRF TRISD
BSF TRISB, 0
BANKSEL PORTD
CLRF PORTD
BANKSEL INTCON
BSF INTCON, GIE
BSF INTCON, INTE
BANKSEL OPTION_REG
BSF OPTION_REG, INTEDG

LOOP
GOTO LOOP

END
